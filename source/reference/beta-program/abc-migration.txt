.. _c2c-beta-abc-migration:

==================
A->B->C Migrations
==================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/beta-feature.rst

.. include:: /includes/abc-migration-intro.rst

Syntax 
------

To perform an A->B->C migration, run the following commands when starting 
:ref:`mongosync <c2c-mongosync>`: 

.. code-block:: shell

   ./bin/mongosync \
         --cluster0 <cluster-A-connection-string> \
         --cluster1 <cluster-B-connection-string> \
         --migrationName <string>

   ./bin/mongosync \
         --cluster0 <cluster-B-connection-string> \
         --cluster1 <cluster-C-connection-string> \
         --migrationName <string>

To start the sync operation between the source and destination clusters, see 
:ref:`c2c-quickstart-synchronize`.

Behavior 
--------

If the first migration fails to finish committing before the second migration 
starts, you might experience data loss.

Example 
-------

The following example performs two consecutive migrations that:

#. Connects a source cluster running on port ``27000`` with a destination 
cluster running on port ``27001``.

#. Uses the destination cluster running on port ``27001`` as a source cluster 
   for the second migration. 

#. Connects the source cluster on port ``27001`` with a destination cluster 
   running on port ``27002``.

The commands also sets the :ref:`--migrationName <c2c-beta-migration-name>` 
option to describe the operations and store migration metadata for each 
sync.

.. code-block:: shell

   ./bin/mongosync \
         --cluster0 "mongodb://localhost:27000" \
         --cluster1 "mongodb://localhost:27001" \
         --migrationName "cluster_27000_to_cluster_27001_sync"

   ./bin/mongosync \
         --cluster0 "mongodb://localhost:27001" \
         --cluster1 "mongodb://localhost:27002" \
         --migrationName "cluster_27001_to_cluster_27002_sync"

Learn More 
----------

- :ref:`c2c-beta-program`
- :ref:`c2c-beta-migration-name`
